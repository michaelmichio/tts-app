# # Redirect www -> non-www (Optional, delete if not needed)
# www.srv986885.hstgr.cloud {
#   redir https://srv986885.hstgr.cloud{uri}
# }

srv986885.hstgr.cloud {
  # Static site (frontend build)
  root * /usr/share/app
  encode gzip
  file_server

  # Cache policy for assets
  @assets path *.js *.css *.png *.jpg *.jpeg *.gif *.svg *.ico *.woff *.woff2
  header @assets Cache-Control "public, max-age=31536000, immutable"

  # SPA fallback (React Router)
  try_files {path} /index.html
  
  # Proxy API -> backend (Gin)
  handle /api/* {
    reverse_proxy backend:8080
  }

  # Proxy Swagger UI & spec
  handle /docs/* {
    reverse_proxy backend:8080
  }
  handle /openapi.yaml {
    reverse_proxy backend:8080
  }

  # Security headers
  header {
    X-Content-Type-Options "nosniff"
    X-Frame-Options "SAMEORIGIN"
    Referrer-Policy "no-referrer-when-downgrade"
    Permissions-Policy "geolocation=(), microphone=(), camera=()"
    Content-Security-Policy "default-src 'self'; img-src 'self' data: blob:; script-src 'self'; style-src 'self' 'unsafe-inline'; connect-src 'self'; font-src 'self' data:"
  }
}
